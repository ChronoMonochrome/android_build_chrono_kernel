VERSION=$(cat /ramdisk/kernel_version)

busybox mkdir -p /ramdisk/modules
busybox mount -o loop,rw -t ext2 /ramdisk/modules-$VERSION.img /ramdisk/modules

busybox insmod /ramdisk/modules/startup_reason.ko
busybox insmod /ramdisk/modules/exfat.ko
busybox insmod /ramdisk/modules/fuse.ko
busybox insmod /ramdisk/modules/sdcardfs.ko
busybox insmod /ramdisk/modules/f2fs.ko
busybox insmod /ramdisk/modules/snd-soc-ab8500_audio.ko

if ! busybox grep -q bootmode=2 /proc/cmdline ; then

	for i in /ramdisk/modules/autoload/*.ko
	do
		busybox insmod $i
	done
fi

if busybox grep -q lcdtype=4 /proc/cmdline ; then
	busybox insmod /ramdisk/modules/display-ws2401_dpi.ko
fi

if ! busybox grep -q lcdtype=4 /proc/cmdline ; then
	busybox insmod /ramdisk/modules/display-s6d27a1_dpi.ko
fi

if busybox grep -q lcdtype=13 /proc/cmdline ; then
	busybox insmod /ramdisk/modules/display-s6d27a1_dpi.ko
fi

if busybox grep -q bootmode=2 /proc/cmdline ; then
	# since it's pain, load j4fs and param from separate partition
	busybox insmod /ramdisk/modules/j4fs.ko
	busybox insmod /ramdisk/modules/param.ko
	busybox mount -t j4fs /dev/block/mmcblk0p1 /mnt/.lfs
	busybox umount /ramdisk/modules
fi
